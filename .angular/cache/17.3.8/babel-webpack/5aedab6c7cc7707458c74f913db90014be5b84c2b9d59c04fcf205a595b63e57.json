{"ast":null,"code":"import _asyncToGenerator from \"/workspaces/mercadito-front-end/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"../../services/api.service\";\nimport * as i2 from \"@angular/router\";\nimport * as i3 from \"../../services/auth.service\";\nimport * as i4 from \"@ionic/angular\";\nimport * as i5 from \"@angular/forms\";\nconst _c0 = [\"registerForm\"];\nexport let RegisterPage = /*#__PURE__*/(() => {\n  var _RegisterPage;\n  class RegisterPage {\n    constructor(apiService, router, authService, toastController // Inyecta ToastController\n    ) {\n      this.apiService = apiService;\n      this.router = router;\n      this.authService = authService;\n      this.toastController = toastController;\n      this.tipo_usuario = false;\n    }\n    ngOnInit() {}\n    updateTipoLabel() {\n      const tipoLabel = document.getElementById('tipo_label');\n      tipoLabel.textContent = this.tipo_usuario ? 'Vendedor' : 'Comprador';\n    }\n    onRegister(form) {\n      var _this = this;\n      const formData = new FormData();\n      const jsonData = {\n        usuario: form.value.usuario,\n        boleta: form.value.boleta,\n        password: form.value.password,\n        password_conf: form.value.password_conf,\n        email: form.value.email,\n        tipo_usuario: this.tipo_usuario ? 'vendedor' : 'comprador'\n      };\n      // Envía los datos al backend\n      this.apiService.register(jsonData).subscribe( /*#__PURE__*/function () {\n        var _ref = _asyncToGenerator(function* (response) {\n          console.log('Respuesta del registro:', response);\n          const toast = yield _this.toastController.create({\n            message: response,\n            duration: 2000,\n            position: 'top'\n          });\n          toast.present();\n          // Realiza el inicio de sesión automático\n          _this.apiService.login(form.value.boleta, form.value.password).subscribe(loginResponse => {\n            localStorage.setItem('currentUser', JSON.stringify(loginResponse));\n            const currentUserString = localStorage.getItem('currentUser');\n            if (currentUserString !== null) {\n              _this.authService.setCurrentUser(JSON.parse(currentUserString));\n              _this.authService.setLoggedIn(true);\n            }\n            _this.router.navigate(['/']);\n          }, error => {\n            console.error('Error al iniciar sesión después del registro:', error);\n          });\n        });\n        return function (_x) {\n          return _ref.apply(this, arguments);\n        };\n      }(), /*#__PURE__*/function () {\n        var _ref2 = _asyncToGenerator(function* (error) {\n          console.error('Error al registrar:', error);\n          const toast = yield _this.toastController.create({\n            message: error.error,\n            duration: 2000,\n            position: 'top'\n          });\n          toast.present();\n        });\n        return function (_x2) {\n          return _ref2.apply(this, arguments);\n        };\n      }());\n    }\n  }\n  _RegisterPage = RegisterPage;\n  _RegisterPage.ɵfac = function RegisterPage_Factory(t) {\n    return new (t || _RegisterPage)(i0.ɵɵdirectiveInject(i1.ApiService), i0.ɵɵdirectiveInject(i2.Router), i0.ɵɵdirectiveInject(i3.AuthService), i0.ɵɵdirectiveInject(i4.ToastController));\n  };\n  _RegisterPage.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n    type: _RegisterPage,\n    selectors: [[\"app-register\"]],\n    viewQuery: function RegisterPage_Query(rf, ctx) {\n      if (rf & 1) {\n        i0.ɵɵviewQuery(_c0, 5);\n      }\n      if (rf & 2) {\n        let _t;\n        i0.ɵɵqueryRefresh(_t = i0.ɵɵloadQuery()) && (ctx.registerForm = _t.first);\n      }\n    },\n    decls: 39,\n    vars: 2,\n    consts: [[\"registerForm\", \"ngForm\"], [\"color\", \"light\", 1, \"ion-padding\"], [\"size\", \"large\", \"name\", \"arrow-back\", \"routerLink\", \"/\"], [\"size\", \"large\"], [3, \"ngSubmit\"], [\"color\", \"light\", 1, \"ion-no-padding\"], [\"type\", \"text\", \"position\", \"stacked\"], [\"type\", \"text\", \"ngModel\", \"\", \"name\", \"usuario\", \"required\", \"\"], [\"position\", \"stacked\"], [\"type\", \"text\", \"ngModel\", \"\", \"name\", \"boleta\", \"required\", \"\"], [\"type\", \"email\", \"ngModel\", \"\", \"name\", \"email\", \"required\", \"\"], [\"type\", \"password\", \"ngModel\", \"\", \"name\", \"password\", \"required\", \"\"], [\"type\", \"password\", \"ngModel\", \"\", \"name\", \"password_conf\", \"required\", \"\"], [\"name\", \"tipo_usuario\", 3, \"ngModelChange\", \"ionChange\", \"ngModel\"], [\"id\", \"tipo_label\"], [\"color\", \"dark\", \"shape\", \"round\", \"expand\", \"block\", \"type\", \"submit\", 3, \"disabled\"], [\"name\", \"arrow-forward\"]],\n    template: function RegisterPage_Template(rf, ctx) {\n      if (rf & 1) {\n        const _r1 = i0.ɵɵgetCurrentView();\n        i0.ɵɵelementStart(0, \"ion-content\", 1);\n        i0.ɵɵelement(1, \"br\")(2, \"ion-icon\", 2)(3, \"br\");\n        i0.ɵɵelementStart(4, \"h2\", 3)(5, \"b\");\n        i0.ɵɵtext(6, \"Registrarse\");\n        i0.ɵɵelementEnd()();\n        i0.ɵɵelementStart(7, \"form\", 4, 0);\n        i0.ɵɵlistener(\"ngSubmit\", function RegisterPage_Template_form_ngSubmit_7_listener() {\n          i0.ɵɵrestoreView(_r1);\n          const registerForm_r2 = i0.ɵɵreference(8);\n          return i0.ɵɵresetView(ctx.onRegister(registerForm_r2));\n        });\n        i0.ɵɵelementStart(9, \"ion-item\", 5)(10, \"ion-label\", 6);\n        i0.ɵɵtext(11, \"Nombre*\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelement(12, \"ion-input\", 7);\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(13, \"ion-item\", 5)(14, \"ion-label\", 8);\n        i0.ɵɵtext(15, \"Boleta*\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelement(16, \"ion-input\", 9);\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(17, \"ion-item\", 5)(18, \"ion-label\", 8);\n        i0.ɵɵtext(19, \"Correo electr\\u00F3nico*\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelement(20, \"ion-input\", 10);\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(21, \"ion-item\", 5)(22, \"ion-label\", 8);\n        i0.ɵɵtext(23, \"Contrase\\u00F1a*\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelement(24, \"ion-input\", 11);\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(25, \"ion-item\", 5)(26, \"ion-label\", 8);\n        i0.ɵɵtext(27, \"Confirmar contrase\\u00F1a*\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelement(28, \"ion-input\", 12);\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(29, \"ion-item\", 5)(30, \"ion-label\", 8);\n        i0.ɵɵtext(31, \"Tipo de cuenta\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(32, \"ion-toggle\", 13);\n        i0.ɵɵtwoWayListener(\"ngModelChange\", function RegisterPage_Template_ion_toggle_ngModelChange_32_listener($event) {\n          i0.ɵɵrestoreView(_r1);\n          i0.ɵɵtwoWayBindingSet(ctx.tipo_usuario, $event) || (ctx.tipo_usuario = $event);\n          return i0.ɵɵresetView($event);\n        });\n        i0.ɵɵlistener(\"ionChange\", function RegisterPage_Template_ion_toggle_ionChange_32_listener() {\n          i0.ɵɵrestoreView(_r1);\n          return i0.ɵɵresetView(ctx.updateTipoLabel());\n        });\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(33, \"ion-label\", 14);\n        i0.ɵɵtext(34, \"Comprador\");\n        i0.ɵɵelementEnd()();\n        i0.ɵɵelement(35, \"br\");\n        i0.ɵɵelementStart(36, \"ion-button\", 15);\n        i0.ɵɵtext(37, \" Registrar \\u00A0\");\n        i0.ɵɵelement(38, \"ion-icon\", 16);\n        i0.ɵɵelementEnd()()();\n      }\n      if (rf & 2) {\n        const registerForm_r2 = i0.ɵɵreference(8);\n        i0.ɵɵadvance(32);\n        i0.ɵɵtwoWayProperty(\"ngModel\", ctx.tipo_usuario);\n        i0.ɵɵadvance(4);\n        i0.ɵɵproperty(\"disabled\", !registerForm_r2.valid);\n      }\n    },\n    dependencies: [i5.ɵNgNoValidate, i5.NgControlStatus, i5.NgControlStatusGroup, i5.RequiredValidator, i5.NgModel, i5.NgForm, i4.IonButton, i4.IonContent, i4.IonIcon, i4.IonInput, i4.IonItem, i4.IonLabel, i4.IonToggle, i4.BooleanValueAccessor, i4.TextValueAccessor, i4.RouterLinkDelegate, i2.RouterLink],\n    styles: [\"ion-button[_ngcontent-%COMP%]{font-size:16px}\"]\n  });\n  return RegisterPage;\n})();","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}