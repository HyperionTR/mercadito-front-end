{"ast":null,"code":"import { IonInfiniteScroll } from '@ionic/angular';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"../../services/api.service\";\nimport * as i2 from \"../../services/auth.service\";\nimport * as i3 from \"@ionic/angular\";\nimport * as i4 from \"@angular/common\";\nimport * as i5 from \"@angular/forms\";\nimport * as i6 from \"@angular/router\";\nconst _c0 = a0 => [\"/tabs/product-details\", a0];\nfunction HomePage_ion_toolbar_1_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"ion-toolbar\", 7)(1, \"ion-grid\", 8)(2, \"ion-row\")(3, \"ion-col\", 9);\n    i0.ɵɵtext(4, \"\\u00A1Se parte de la comunidad!\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(5, \"ion-col\", 10)(6, \"ion-button\", 11);\n    i0.ɵɵtext(7, \"Registrarse\");\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(8, \"ion-col\", 12)(9, \"ion-button\", 13);\n    i0.ɵɵtext(10, \"Iniciar sesi\\u00F3n\");\n    i0.ɵɵelementEnd()()()()();\n  }\n}\nfunction HomePage_ion_toolbar_2_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"ion-toolbar\", 14)(1, \"p\", 15);\n    i0.ɵɵtext(2, \"\\u00A1Bienvenido!\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(3, \"p\", 16)(4, \"b\");\n    i0.ɵɵtext(5);\n    i0.ɵɵelementEnd()()();\n  }\n  if (rf & 2) {\n    const ctx_r0 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(5);\n    i0.ɵɵtextInterpolate(ctx_r0.currentUser.nombre_de_usuario);\n  }\n}\nfunction HomePage_ion_col_7_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"ion-col\", 17);\n    i0.ɵɵelement(1, \"img\", 18);\n    i0.ɵɵelementStart(2, \"p\", 19);\n    i0.ɵɵtext(3);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(4, \"p\", 20);\n    i0.ɵɵelement(5, \"br\");\n    i0.ɵɵelementStart(6, \"b\");\n    i0.ɵɵtext(7);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelement(8, \"br\");\n    i0.ɵɵtext(9);\n    i0.ɵɵelementEnd()();\n  }\n  if (rf & 2) {\n    const product_r2 = ctx.$implicit;\n    i0.ɵɵadvance();\n    i0.ɵɵproperty(\"src\", product_r2.imagen ? \"https://mercadito-app.azurewebsites.net/images/products/\" + product_r2.imagen : \"https://via.placeholder.com/150\", i0.ɵɵsanitizeUrl)(\"routerLink\", i0.ɵɵpureFunction1(5, _c0, product_r2.id_producto));\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate1(\" \", product_r2.nombre, \" \");\n    i0.ɵɵadvance(4);\n    i0.ɵɵtextInterpolate(product_r2.precio);\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate1(\" por \", product_r2.nombre_de_usuario, \"\");\n  }\n}\nexport let HomePage = /*#__PURE__*/(() => {\n  var _HomePage;\n  class HomePage {\n    constructor(apiService, authService) {\n      this.apiService = apiService;\n      this.authService = authService;\n      this.products = []; // Array para almacenar los productos\n      this.currentPage = 1; // Página actual\n      this.searchTerm = ''; // Término de búsqueda\n      this.isLoggedIn = false;\n    }\n    ngOnInit() {\n      this.checkLoggedIn();\n      // this.loadData(null);\n      this.authService.isLoggedIn$().subscribe(isLoggedIn => {\n        this.isLoggedIn = isLoggedIn;\n      });\n      this.authService.currentUser$().subscribe(currentUser => {\n        this.currentUser = currentUser;\n        console.log(this.currentUser);\n      });\n      this.apiService.getProducts(this.currentPage).subscribe(data => {\n        this.products = data;\n        this.currentPage++;\n      }, error => {\n        console.error('Error al cargar productos:', error);\n      });\n    }\n    checkLoggedIn() {\n      const currentUserString = localStorage.getItem('currentUser');\n      if (currentUserString !== null) {\n        this.authService.setCurrentUser(JSON.parse(currentUserString));\n        this.authService.setLoggedIn(true);\n      }\n    }\n    loadData(event) {\n      if (this.searchTerm) {\n        // Si hay un término de búsqueda, usa products/search\n        this.apiService.searchProducts(this.currentPage, this.searchTerm).subscribe(data => {\n          // Al no haber más productos, se deshabilita el scroll infinito\n          if (data && data.length > 0) {\n            this.products = this.products.concat(data);\n            this.currentPage++;\n          } else {\n            if (event) {\n              event.target.disabled = true;\n            }\n          }\n          if (event) {\n            event.target.complete(); // Completa el evento del scroll infinito\n          }\n        }, error => {\n          console.error('Error al cargar productos de búsqueda:', error);\n          if (event) {\n            event.target.complete(); // Completa el evento del scroll infinito\n          }\n        });\n      } else {\n        // Si no hay término de búsqueda, carga más productos de products/data\n        this.apiService.getProducts(this.currentPage).subscribe(data => {\n          if (data && data.length > 0) {\n            this.products = this.products.concat(data);\n            this.currentPage++;\n          } else {\n            if (event) {\n              event.target.disabled = true;\n            }\n          }\n          if (event) {\n            event.target.complete(); // Completa el evento del scroll infinito\n          }\n        }, error => {\n          console.error('Error al cargar más productos:', error);\n          if (event) {\n            event.target.complete(); // Completa el evento del scroll infinito\n          }\n        });\n      }\n    }\n    onSearchChange() {\n      this.products = [];\n      this.currentPage = 1;\n      this.infiniteScroll.disabled = false; // Habilita el scroll infinito nuevamente\n      this.loadData(null);\n    }\n  }\n  _HomePage = HomePage;\n  _HomePage.ɵfac = function HomePage_Factory(t) {\n    return new (t || _HomePage)(i0.ɵɵdirectiveInject(i1.ApiService), i0.ɵɵdirectiveInject(i2.AuthService));\n  };\n  _HomePage.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n    type: _HomePage,\n    selectors: [[\"app-home\"]],\n    viewQuery: function HomePage_Query(rf, ctx) {\n      if (rf & 1) {\n        i0.ɵɵviewQuery(IonInfiniteScroll, 5);\n      }\n      if (rf & 2) {\n        let _t;\n        i0.ɵɵqueryRefresh(_t = i0.ɵɵloadQuery()) && (ctx.infiniteScroll = _t.first);\n      }\n    },\n    decls: 10,\n    vars: 5,\n    consts: [[\"color\", \"dark\", 4, \"ngIf\"], [\"color\", \"light\", 4, \"ngIf\"], [3, \"fullscreen\"], [\"placeholder\", \"Buscar productos\", 3, \"ngModelChange\", \"ionChange\", \"ngModel\"], [\"size\", \"6\", 4, \"ngFor\", \"ngForOf\"], [\"threshold\", \"100px\", 3, \"ionInfinite\"], [\"loadingSpinner\", \"bubbles\", \"loadingText\", \"Cargando...\"], [\"color\", \"dark\"], [1, \"ion-text-center\"], [\"size\", \"5\"], [\"size\", \"3\"], [\"size\", \"small\", \"color\", \"light\", \"shape\", \"round\", \"routerLink\", \"/register\"], [\"size\", \"4\"], [\"size\", \"small\", \"color\", \"light\", \"shape\", \"round\", \"routerLink\", \"/login\"], [\"color\", \"light\"], [2, \"margin-left\", \"10px\"], [2, \"font-size\", \"16px\", \"margin-left\", \"10px\", \"margin-top\", \"-10px\"], [\"size\", \"6\"], [\"width\", \"100%\", \"alt\", \"Product Image\", 3, \"src\", \"routerLink\"], [2, \"font-size\", \"16px\", \"margin-top\", \"0px\"], [2, \"margin-top\", \"-30px\"]],\n    template: function HomePage_Template(rf, ctx) {\n      if (rf & 1) {\n        i0.ɵɵelementStart(0, \"ion-header\");\n        i0.ɵɵtemplate(1, HomePage_ion_toolbar_1_Template, 11, 0, \"ion-toolbar\", 0)(2, HomePage_ion_toolbar_2_Template, 6, 1, \"ion-toolbar\", 1);\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(3, \"ion-content\", 2)(4, \"ion-searchbar\", 3);\n        i0.ɵɵtwoWayListener(\"ngModelChange\", function HomePage_Template_ion_searchbar_ngModelChange_4_listener($event) {\n          i0.ɵɵtwoWayBindingSet(ctx.searchTerm, $event) || (ctx.searchTerm = $event);\n          return $event;\n        });\n        i0.ɵɵlistener(\"ionChange\", function HomePage_Template_ion_searchbar_ionChange_4_listener() {\n          return ctx.onSearchChange();\n        });\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(5, \"ion-grid\")(6, \"ion-row\");\n        i0.ɵɵtemplate(7, HomePage_ion_col_7_Template, 10, 7, \"ion-col\", 4);\n        i0.ɵɵelementEnd()();\n        i0.ɵɵelementStart(8, \"ion-infinite-scroll\", 5);\n        i0.ɵɵlistener(\"ionInfinite\", function HomePage_Template_ion_infinite_scroll_ionInfinite_8_listener($event) {\n          return ctx.loadData($event);\n        });\n        i0.ɵɵelement(9, \"ion-infinite-scroll-content\", 6);\n        i0.ɵɵelementEnd()();\n      }\n      if (rf & 2) {\n        i0.ɵɵadvance();\n        i0.ɵɵproperty(\"ngIf\", !ctx.isLoggedIn);\n        i0.ɵɵadvance();\n        i0.ɵɵproperty(\"ngIf\", ctx.isLoggedIn);\n        i0.ɵɵadvance();\n        i0.ɵɵproperty(\"fullscreen\", true);\n        i0.ɵɵadvance();\n        i0.ɵɵtwoWayProperty(\"ngModel\", ctx.searchTerm);\n        i0.ɵɵadvance(3);\n        i0.ɵɵproperty(\"ngForOf\", ctx.products);\n      }\n    },\n    dependencies: [i3.IonButton, i3.IonCol, i3.IonContent, i3.IonGrid, i3.IonHeader, i3.IonInfiniteScroll, i3.IonInfiniteScrollContent, i3.IonRow, i3.IonSearchbar, i3.IonToolbar, i3.TextValueAccessor, i3.RouterLinkDelegate, i4.NgForOf, i4.NgIf, i5.NgControlStatus, i5.NgModel, i6.RouterLink],\n    styles: [\"ion-button[_ngcontent-%COMP%]{font-size:12px;white-space:nowrap;width:90px;height:35px}p[_ngcontent-%COMP%]{font-size:14px}img[_ngcontent-%COMP%]{border-radius:20px}\"]\n  });\n  return HomePage;\n})();","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}